<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stickräknare</title>

  <!-- appikon och manifest -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <meta name="theme-color" content="#f7f7f5">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Stickräknare">
  <link rel="apple-touch-icon" href="icon-512.png">

  <!-- react + tailwind -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: #f7f7f5;
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: #1a1a1a;
      -webkit-tap-highlight-color: transparent;
    }
    input:focus, button:focus { outline: none; }
    .input-clear {
      position: absolute; right: .5rem; top: 50%; transform: translateY(-50%);
      background: transparent; border: 0; padding: .25rem; line-height: 1; cursor: pointer;
      color: #9ca3af; /* stone-400 */
    }
    .input-clear:hover { color: #4b5563; } /* stone-600 */
  </style>
</head>
<body>
  <div id="root" class="min-h-screen flex flex-col items-center justify-center p-6"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    function Stickraknare() {
      const [count1, setCount1] = useState(() => parseInt(localStorage.getItem("stick-count1") || 0));
      const [count2, setCount2] = useState(() => parseInt(localStorage.getItem("stick-count2") || 0));
      const [name1, setName1] = useState(() => localStorage.getItem("stick-name1") || "Räknare 1");
      const [name2, setName2] = useState(() => localStorage.getItem("stick-name2") || "Räknare 2");
      const [keepAwake, setKeepAwake] = useState(() => localStorage.getItem("stick-keep-awake") === "true");
      const [wakeLock, setWakeLock] = useState(null);

      // persist
      useEffect(() => localStorage.setItem("stick-count1", count1), [count1]);
      useEffect(() => localStorage.setItem("stick-count2", count2), [count2]);
      useEffect(() => localStorage.setItem("stick-name1", name1), [name1]);
      useEffect(() => localStorage.setItem("stick-name2", name2), [name2]);
      useEffect(() => localStorage.setItem("stick-keep-awake", keepAwake), [keepAwake]);

      // wake lock
      useEffect(() => {
        if (keepAwake) requestWakeLock();
        else releaseWakeLock();
        return () => releaseWakeLock();
      }, [keepAwake]);

      async function requestWakeLock() {
        try {
          if ("wakeLock" in navigator) {
            const lock = await navigator.wakeLock.request("screen");
            setWakeLock(lock);
          }
        } catch (err) {
          console.log("Wake lock error:", err);
        }
      }
      function releaseWakeLock() {
        if (wakeLock) {
          wakeLock.release();
          setWakeLock(null);
        }
      }

      const CounterCard = ({ initialName, onCommitName, count, setCount }) => {
        const [localName, setLocalName] = useState(initialName);
        const inputRef = useRef(null);

        // synca om initialName ändras utifrån
        useEffect(() => { setLocalName(initialName); }, [initialName]);

        const commit = () => {
          const v = (localName || "").trim();
          onCommitName(v || initialName); // behåll gammalt namn om tomt
        };

        const onKeyDown = (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            commit();
            // behåll fokus så tangentbordet inte fälls ned
            requestAnimationFrame(() => inputRef.current && inputRef.current.focus());
          }
        };

        const clearName = () => {
          setLocalName("");
          requestAnimationFrame(() => inputRef.current && inputRef.current.focus());
        };

        return (
          <div className="bg-white rounded-2xl shadow-sm p-6 border border-stone-200">
            <div className="relative">
              <input
                ref={inputRef}
                type="text"
                inputMode="text"
                autoComplete="off"
                autoCorrect="off"
                autoCapitalize="sentences"
                spellCheck="false"
                value={localName}
                onChange={(e) => setLocalName(e.target.value)}
                onBlur={commit}
                onKeyDown={onKeyDown}
                className="text-xl font-semibold mb-3 w-full text-center bg-transparent border-b border-stone-300 focus:border-stone-500"
                placeholder="Namn på räknare"
              />
              {localName?.length > 0 && (
                <button type="button" aria-label="Rensa namn" className="input-clear" onClick={clearName}>
                  ×
                </button>
              )}
            </div>

            <div className="text-6xl font-light mb-6 text-stone-900">{count}</div>
            <button
              onClick={() => setCount(count + 1)}
              className="w-full bg-stone-900 text-white py-4 rounded-lg text-lg tracking-wide transition-all hover:bg-stone-800 active:scale-95"
            >
              Lägg till varv
            </button>
            <div className="flex justify-between mt-4 gap-2">
              <button
                onClick={() => setCount(Math.max(0, count - 1))}
                className="flex-1 bg-white border border-stone-300 text-stone-700 py-3 rounded-lg text-sm hover:bg-stone-100 active:scale-95 transition"
              >
                Ångra
              </button>
              <button
                onClick={() => setCount(0)}
                className="flex-1 bg-white border border-stone-300 text-stone-700 py-3 rounded-lg text-sm hover:bg-stone-100 active:scale-95 transition"
              >
                Nollställ
              </button>
            </div>
          </div>
        );
      };

      return (
        <main className="max-w-md w-full space-y-8">
          <header className="text-center">
            <h1 className="text-3xl font-semibold mb-2">Stickräknare</h1>
            <p className="text-stone-500 text-sm">Håll koll på dina varv</p>
          </header>

          <div className="flex items-center justify-center gap-2">
            <input
              id="keep-awake"
              type="checkbox"
              checked={keepAwake}
              onChange={(e) => setKeepAwake(e.target.checked)}
              className="w-5 h-5 accent-stone-700 cursor-pointer"
            />
            <label htmlFor="keep-awake" className="text-stone-600 text-sm select-none">
              Håll skärmen vaken
            </label>
          </div>

          <CounterCard
            initialName={name1}
            onCommitName={setName1}
            count={count1}
            setCount={setCount1}
          />
          <CounterCard
            initialName={name2}
            onCommitName={setName2}
            count={count2}
            setCount={setCount2}
          />

          <footer className="text-center text-xs text-stone-400 pt-4">
            gjord med ♥ i sverige
          </footer>
        </main>
      );
    }

    ReactDOM.render(<Stickraknare />, document.getElementById("root"));
  </script>
</body>
</html>
