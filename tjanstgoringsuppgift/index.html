<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enskild tjänsterapport</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'military-green': '#4a5d3e',
            'military-blue': '#2c4a5a',
            'military-tan': '#8b7d6b',
          }
        }
      }
    }
  </script>
<style>
  @media screen {
    body {
      background: linear-gradient(135deg, #1a2930 0%, #2c4a5a 50%, #1a2930 100%);
      min-height: 100vh;
    }
    #print-content { display: none !important; }
  }
  @media print {
    body * { visibility: hidden !important; }
    #print-content, #print-content * { visibility: visible !important; }
    #root { display: none !important; }
    #print-content { display: block !important; position: static !important; }
    html, body {
      margin: 0 !important; padding: 0 !important; background: #ffffff !important;
      -webkit-print-color-adjust: exact; print-color-adjust: exact;
    }
    table { page-break-inside: avoid !important; }
    @page { size: A4; margin: 15mm; }
    img { display: none !important; }
    #print-content img { display: inline !important; }
  }
</style>
</head>
<body>
  <div id="root"></div>
  <div id="print-content"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const Plus = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );
    const Trash2 = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
      </svg>
    );
    const Copy = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    );
    const Printer = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="6 9 6 2 18 2 18 9"></polyline>
        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
        <rect x="6" y="14" width="12" height="8"></rect>
      </svg>
    );

    function TjanstgoringsApp() {
      const [grundInfo, setGrundInfo] = useState({
        namn: '',
        personnr: '',
        forband: '',
        forbandsnr: '',
        manad: ''
      });

      const [uppgifter, setUppgifter] = useState([]);
      const [nyRad, setNyRad] = useState({ datum: '', arbetsuppgift: '', tim: '', km: '', ansvarig: '' });
      const [kopierad, setKopierad] = useState(false);

      useEffect(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const deladeData = urlParams.get('data');
        if (deladeData) {
          try {
            const decoded = JSON.parse(atob(deladeData));
            setGrundInfo(decoded.grundInfo);
            setUppgifter(decoded.uppgifter);
          } catch (e) {
            console.error('Kunde inte ladda delad data');
          }
        } else {
          const sparadGrund = localStorage.getItem('grundInfo');
          const sparadeUppgifter = localStorage.getItem('uppgifter');
          if (sparadGrund) setGrundInfo(JSON.parse(sparadGrund));
          if (sparadeUppgifter) setUppgifter(JSON.parse(sparadeUppgifter));
        }
      }, []);

      useEffect(() => { localStorage.setItem('grundInfo', JSON.stringify(grundInfo)); }, [grundInfo]);
      useEffect(() => { localStorage.setItem('uppgifter', JSON.stringify(uppgifter)); }, [uppgifter]);
      useEffect(() => { updatePrintContent(); }, [grundInfo, uppgifter]);

      const updatePrintContent = () => {
        const printDiv = document.getElementById('print-content');
        const rowsPerPage = 12;
        const totalPages = Math.ceil(uppgifter.length / rowsPerPage) || 1;

        const createPage = (pageUppgifter, pageNum, totalPages) => {
          const emptyRows = Math.max(0, rowsPerPage - pageUppgifter.length);
          return `
            <div style="font-family: Arial, sans-serif; padding: 12mm; font-size: 9pt; page-break-after: ${pageNum < totalPages ? 'always' : 'auto'};">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <img src="logo-left.png" alt="Logo" style="height: 50px;" onerror="this.style.display='none'" />
                <div style="text-align: center; flex: 1;">
                  <div style="font-size: 8pt; font-weight: bold;">
                    GÖTEBORGS GARNISON<br/>
                    ELFSBORGSGRUPPEN
                  </div>
                  <div style="font-size: 12pt; font-weight: bold; margin-top: 8px;">
                    ENSKILD<br/>
                    TJÄNSTERAPPORT
                  </div>
                </div>
                <img src="logo-right.png" alt="Logo" style="height: 50px;" onerror="this.style.display='none'" />
              </div>

              <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px; border: 2px solid black;">
                <tbody>
                  <tr>
                    <td style="border: 1px solid black; padding: 4px; font-weight: bold; width: 25%;">Namn</td>
                    <td style="border: 1px solid black; padding: 4px; width: 50%;">${grundInfo.namn}</td>
                    <td style="border: 1px solid black; padding: 4px; font-weight: bold; width: 25%;">OrgE</td>
                  </tr>
                  <tr>
                    <td style="border: 1px solid black; padding: 4px; font-weight: bold;">Personnummer</td>
                    <td style="border: 1px solid black; padding: 4px;">${grundInfo.personnr}</td>
                    <td style="border: 1px solid black; padding: 4px; font-weight: bold;">Ärendenr</td>
                  </tr>
                  <tr>
                    <td style="border: 1px solid black; padding: 4px; font-weight: bold;">Förband/Enhet</td>
                    <td style="border: 1px solid black; padding: 4px;">${grundInfo.forband}</td>
                    <td style="border: 1px solid black; padding: 4px; font-weight: bold;">Övertid (h)</td>
                  </tr>
                  <tr>
                    <td style="border: 1px solid black; padding: 4px; font-weight: bold;">Förbandskod</td>
                    <td style="border: 1px solid black; padding: 4px;" colspan="2">${grundInfo.forbandsnr}</td>
                  </tr>
                  <tr>
                    <td style="border: 1px solid black; padding: 4px; font-weight: bold;">Månad/år</td>
                    <td style="border: 1px solid black; padding: 4px;" colspan="2">${grundInfo.manad}</td>
                  </tr>
                </tbody>
              </table>

              <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px; border: 2px solid black;">
                <thead>
                  <tr>
                    <th style="border: 1px solid black; padding: 4px; background-color: #f0f0f0; width: 12%;">Datum</th>
                    <th style="border: 1px solid black; padding: 4px; background-color: #f0f0f0; width: 38%;">Uppdrag/Tjänsteåtgärd</th>
                    <th style="border: 1px solid black; padding: 4px; background-color: #f0f0f0; width: 20%;">Förman/Beställare</th>
                    <th style="border: 1px solid black; padding: 4px; background-color: #f0f0f0; width: 15%;">Timmar</th>
                    <th style="border: 1px solid black; padding: 4px; background-color: #f0f0f0; width: 15%;">Km (tjänsteresa)</th>
                  </tr>
                </thead>
                <tbody>
                  ${pageUppgifter.map(u => `
                    <tr>
                      <td style="border: 1px solid black; padding: 4px;">${u.datum}</td>
                      <td style="border: 1px solid black; padding: 4px;">${u.arbetsuppgift}</td>
                      <td style="border: 1px solid black; padding: 4px;">${u.ansvarig || ''}</td>
                      <td style="border: 1px solid black; padding: 4px; text-align: center;">${u.tim}</td>
                      <td style="border: 1px solid black; padding: 4px; text-align: center;">${u.km || ''}</td>
                    </tr>
                  `).join('')}
                  ${Array(emptyRows).fill(0).map(() => `
                    <tr>
                      <td style="border: 1px solid black; padding: 4px; height: 20px;">&nbsp;</td>
                      <td style="border: 1px solid black; padding: 4px;">&nbsp;</td>
                      <td style="border: 1px solid black; padding: 4px;">&nbsp;</td>
                      <td style="border: 1px solid black; padding: 4px;">&nbsp;</td>
                      <td style="border: 1px solid black; padding: 4px;">&nbsp;</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>

              <div style="display: flex; justify-content: space-between; font-size: 7pt; margin-top: 12px;">
                <div style="width: 30%;">
                  <div style="margin-bottom: 2px; font-weight: bold;">Uppgifterna vidimeras:</div>
                  <div>Ort och datum: Göteborg 20___-___-___</div>
                  <div style="margin-top: 15px; border-top: 1px solid black; padding-top: 2px;">Namnteckning</div>
                  <div style="margin-top: 8px; border-top: 1px solid black; padding-top: 2px;">Namnförtydligande</div>
                  <div style="margin-top: 8px; border-top: 1px solid black; padding-top: 2px;">Befattning</div>
                </div>
                <div style="width: 30%;">
                  <div style="margin-bottom: 2px; font-weight: bold;">Bestyrks av chef:</div>
                  <div>Ort och datum: Göteborg 20___-___-___</div>
                  <div style="margin-top: 15px; border-top: 1px solid black; padding-top: 2px;">Namnteckning</div>
                  <div style="margin-top: 8px; border-top: 1px solid black; padding-top: 2px;">Namnförtydligande</div>
                  <div style="margin-top: 8px; border-top: 1px solid black; padding-top: 2px;">Befattning</div>
                </div>
                <div style="width: 30%;">
                  <div style="margin-bottom: 2px; font-weight: bold;">Registrerat:</div>
                  <div>Ort och datum: Göteborg 20___-___-___</div>
                  <div style="margin-top: 15px; border-top: 1px solid black; padding-top: 2px;">Namnteckning</div>
                  <div style="margin-top: 8px; border-top: 1px solid black; padding-top: 2px;">Namnförtydligande</div>
                  <div style="margin-top: 8px; border-top: 1px solid black; padding-top: 2px;">Befattning</div>
                </div>
              </div>
            </div>
          `;
        };

        let pages = '';
        for (let i = 0; i < totalPages; i++) {
          const start = i * rowsPerPage;
          const end = Math.min(start + rowsPerPage, uppgifter.length);
          const pageUppgifter = uppgifter.slice(start, end);
          pages += createPage(pageUppgifter, i + 1, totalPages);
        }
        printDiv.innerHTML = pages;
      };

      const laggTillUppgift = () => {
        if (nyRad.datum && nyRad.arbetsuppgift) {
          setUppgifter([...uppgifter, { ...nyRad, id: Date.now() }]);
          setNyRad({ datum: '', arbetsuppgift: '', tim: '', km: '', ansvarig: '' });
        }
      };
      const taBortUppgift = (id) => { setUppgifter(uppgifter.filter(u => u.id !== id)); };

      const kopieraLank = async () => {
        const data = { grundInfo, uppgifter };
        const encoded = btoa(JSON.stringify(data));
        const url = `${window.location.origin}${window.location.pathname}?data=${encoded}`;
        try {
          await navigator.clipboard.writeText(url);
          setKopierad(true);
          setTimeout(() => setKopierad(false), 3000);
        } catch (e) {
          alert('Länk: ' + url);
        }
      };

      return (
        <div className="max-w-4xl mx-auto p-4">
          <div className="bg-gradient-to-br from-gray-900 to-gray-800 rounded-lg shadow-2xl p-6 mb-4 border border-military-green">
            <div className="text-center mb-6 pb-4 border-b border-military-green">
              <div className="inline-block bg-military-green px-6 py-2 rounded-full mb-2">
                <span className="text-yellow-400 font-bold text-sm tracking-widest">433 GATHENHIELMS</span>
              </div>
              <h1 className="text-3xl font-bold text-white mb-1">Enskild tjänsterapport</h1>
              <p className="text-military-tan text-sm tracking-wide">MARINA HEMVÄRNSKOMPANI</p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
              <input
                type="text"
                placeholder="Namn"
                value={grundInfo.namn}
                onChange={(e) => setGrundInfo({...grundInfo, namn: e.target.value})}
                className="bg-gray-800 border border-gray-700 rounded p-3 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
              />
              <input
                type="text"
                placeholder="Personnummer"
                value={grundInfo.personnr}
                onChange={(e) => setGrundInfo({...grundInfo, personnr: e.target.value})}
                className="bg-gray-800 border border-gray-700 rounded p-3 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
              />
              <input
                type="text"
                placeholder="Förband/Enhet"
                value={grundInfo.forband}
                onChange={(e) => setGrundInfo({...grundInfo, forband: e.target.value})}
                className="bg-gray-800 border border-gray-700 rounded p-3 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
              />
              <input
                type="text"
                placeholder="Förbandskod"
                value={grundInfo.forbandsnr}
                onChange={(e) => setGrundInfo({...grundInfo, forbandsnr: e.target.value})}
                className="bg-gray-800 border border-gray-700 rounded p-3 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
              />
              <input
                type="text"
                placeholder="Månad/år (t.ex. Oktober 2025)"
                value={grundInfo.manad}
                onChange={(e) => setGrundInfo({...grundInfo, manad: e.target.value})}
                className="bg-gray-800 border border-gray-700 rounded p-3 text-white placeholder-gray-500 focus:border-military-green focus:outline-none md:col-span-2"
              />
            </div>

            <div className="border-t border-gray-700 pt-4 mb-4">
              <h2 className="text-lg font-semibold mb-3 text-white flex items-center gap-2">
                <span className="text-military-green">▸</span> registrera post
              </h2>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-2">
                <div className="col-span-2 md:col-span-1">
                  <label className="block text-xs text-gray-400 mb-1">Datum</label>
                  <input
                    type="date"
                    value={nyRad.datum}
                    onChange={(e) => setNyRad({...nyRad, datum: e.target.value})}
                    className="w-full bg-gray-800 border border-gray-700 rounded p-2 text-white focus:border-military-green focus:outline-none"
                  />
                </div>
                <div className="col-span-2 md:col-span-1">
                  <label className="block text-xs text-gray-400 mb-1">Uppdrag/Tjänsteåtgärd</label>
                  <input
                    type="text"
                    placeholder="t.ex. Materielvård"
                    value={nyRad.arbetsuppgift}
                    onChange={(e) => setNyRad({...nyRad, arbetsuppgift: e.target.value})}
                    className="w-full bg-gray-800 border border-gray-700 rounded p-2 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
                  />
                </div>
                <div>
                  <label className="block text-xs text-gray-400 mb-1">Förman/Beställare</label>
                  <input
                    type="text"
                    placeholder="Namn"
                    value={nyRad.ansvarig}
                    onChange={(e) => setNyRad({...nyRad, ansvarig: e.target.value})}
                    className="w-full bg-gray-800 border border-gray-700 rounded p-2 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
                  />
                </div>
                <div>
                  <label className="block text-xs text-gray-400 mb-1">Timmar</label>
                  <input
                    type="number"
                    placeholder="8"
                    value={nyRad.tim}
                    onChange={(e) => setNyRad({...nyRad, tim: e.target.value})}
                    className="w-full bg-gray-800 border border-gray-700 rounded p-2 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
                  />
                </div>
              </div>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-2">
                <div className="col-span-2 md:col-span-4">
                  <label className="block text-xs text-gray-400 mb-1">Kilometer (tjänsteresa)</label>
                  <input
                    type="number"
                    placeholder="50"
                    value={nyRad.km}
                    onChange={(e) => setNyRad({...nyRad, km: e.target.value})}
                    className="w-full bg-gray-800 border border-gray-700 rounded p-2 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
                  />
                </div>
              </div>
              <button
                onClick={laggTillUppgift}
                className="w-full bg-military-green text-white rounded p-2 flex items-center justify-center gap-2 hover:bg-opacity-90"
              >
                <Plus /> lägg till post
              </button>
            </div>

            {uppgifter.length > 0 && (
              <div className="border-t border-gray-700 pt-4 mb-4">
                <h2 className="text-lg font-semibold mb-3 text-white flex items-center gap-2">
                  <span className="text-military-green">▸</span> registrerade poster
                </h2>
                <div className="space-y-2">
                  {uppgifter.map(u => (
                    <div key={u.id} className="flex items-center gap-2 bg-gray-800 border border-gray-700 p-3 rounded hover:border-military-green transition-colors">
                      <div className="flex-1 grid grid-cols-2 md:grid-cols-5 gap-2 text-sm text-gray-300">
                        <span className="font-medium text-white">{u.datum}</span>
                        <span className="col-span-1 md:col-span-2">{u.arbetsuppgift}</span>
                        <span className="text-military-tan">{u.ansvarig || '-'}</span>
                        <span className="text-military-tan">{u.tim} h {u.km && `/ ${u.km} km`}</span>
                      </div>
                      <button
                        onClick={() => taBortUppgift(u.id)}
                        className="text-red-400 hover:text-red-300 transition-colors"
                      >
                        <Trash2 />
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}

            <div className="bg-gray-800 border border-gray-700 rounded-lg p-4 mt-6">
              <h3 className="font-bold text-lg mb-2 text-white">dela länk</h3>
              <p className="text-sm text-gray-400 mb-3">kopiera en delbar länk eller spara lokalt:</p>
              <ol className="text-sm text-gray-400 mb-4 space-y-1 list-decimal list-inside">
                <li>välj “kopiera länk”</li>
                <li>skicka länken till dig själv</li>
                <li>öppna på dator</li>
                <li>klart</li>
              </ol>
              <button
                onClick={kopieraLank}
                className="w-full bg-military-blue text-white rounded p-3 flex items-center justify-center gap-2 hover:brightness-110 transition-all font-semibold shadow-lg"
              >
                <Copy /> {kopierad ? '✓ länk kopierad' : 'kopiera länk'}
              </button>
            </div>

            <div className="bg-gray-800 border border-gray-700 rounded-lg p-4 mt-4">
              <h3 className="font-bold text-lg mb-2 text-white">utskrift</h3>
              <p className="text-sm text-gray-400 mb-3">skriv ut eller spara som pdf:</p>
              <button
                onClick={() => window.print()}
                className="w-full bg-military-green text-white rounded p-3 flex items-center justify-center gap-2 hover:brightness-110 transition-all font-semibold shadow-lg"
              >
                <Printer /> skriv ut formulär
              </button>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<TjanstgoringsApp />, document.getElementById('root'));
  </script>
</body>
</html>
