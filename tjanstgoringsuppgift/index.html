<!DOCTYPE html>

<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tjänstgöringsuppgift</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'military-green': '#4a5d3e',
            'military-blue': '#2c4a5a',
            'military-tan': '#8b7d6b',
          }
        }
      }
    }
  </script>
  <style>
    body {
      background: linear-gradient(135deg, #1a2930 0%, #2c4a5a 50%, #1a2930 100%);
      min-height: 100vh;
    }

```
@media print {
  .screen-only { display: none !important; }
  .print-only { display: block !important; }
  body { margin: 0; background: white; }
  
  /* Tvinga allt på en sida */
  .print-only {
    page-break-inside: avoid;
    page-break-after: avoid;
  }
  table {
    page-break-inside: avoid;
  }
  
  /* Komprimera lite för att få plats */
  .print-only > div {
    font-size: 10pt !important;
  }
  table {
    font-size: 9pt !important;
  }
  td, th {
    padding: 4px !important;
  }
  .signatures {
    font-size: 8pt !important;
    margin-top: 20px !important;
  }
  .sig-line {
    margin-top: 15px !important;
  }
}
@media screen {
  .print-only { display: none; }
}
```

  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide icons as inline SVG
    const Plus = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Trash2 = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
      </svg>
    );

    const Copy = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    );

    const Printer = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="6 9 6 2 18 2 18 9"></polyline>
        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
        <rect x="6" y="14" width="12" height="8"></rect>
      </svg>
    );

    function TjanstgoringsApp() {
      const [grundInfo, setGrundInfo] = useState({
        namn: '',
        personnr: '',
        forband: '',
        forbandsnr: '',
        manad: ''
      });

      const [uppgifter, setUppgifter] = useState([]);
      const [nyRad, setNyRad] = useState({ datum: '', arbetsuppgift: '', tim: '', km: '' });
      const [kopierad, setKopierad] = useState(false);

      // Ladda data från URL eller localStorage
      useEffect(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const deladeData = urlParams.get('data');
        
        if (deladeData) {
          try {
            const decoded = JSON.parse(atob(deladeData));
            setGrundInfo(decoded.grundInfo);
            setUppgifter(decoded.uppgifter);
          } catch (e) {
            console.error('Kunde inte ladda delad data');
          }
        } else {
          const sparadGrund = localStorage.getItem('grundInfo');
          const sparadeUppgifter = localStorage.getItem('uppgifter');
          if (sparadGrund) setGrundInfo(JSON.parse(sparadGrund));
          if (sparadeUppgifter) setUppgifter(JSON.parse(sparadeUppgifter));
        }
      }, []);

      useEffect(() => {
        localStorage.setItem('grundInfo', JSON.stringify(grundInfo));
      }, [grundInfo]);

      useEffect(() => {
        localStorage.setItem('uppgifter', JSON.stringify(uppgifter));
      }, [uppgifter]);

      const laggTillUppgift = () => {
        if (nyRad.datum && nyRad.arbetsuppgift) {
          setUppgifter([...uppgifter, { ...nyRad, id: Date.now() }]);
          setNyRad({ datum: '', arbetsuppgift: '', tim: '', km: '' });
        }
      };

      const taBortUppgift = (id) => {
        setUppgifter(uppgifter.filter(u => u.id !== id));
      };

      const kopieraLank = async () => {
        const data = { grundInfo, uppgifter };
        const encoded = btoa(JSON.stringify(data));
        const url = `${window.location.origin}${window.location.pathname}?data=${encoded}`;
        
        try {
          await navigator.clipboard.writeText(url);
          setKopierad(true);
          setTimeout(() => setKopierad(false), 3000);
        } catch (e) {
          alert('Länk: ' + url);
        }
      };

      return (
        <div className="min-h-screen bg-gray-50">
          {/* Mobil/Desktop redigeringsvy */}
          <div className="screen-only max-w-4xl mx-auto p-4">
            <div className="bg-gradient-to-br from-gray-900 to-gray-800 rounded-lg shadow-2xl p-6 mb-4 border border-military-green">
              <div className="text-center mb-6 pb-4 border-b border-military-green">
                <div className="inline-block bg-military-green px-6 py-2 rounded-full mb-2">
                  <span className="text-yellow-400 font-bold text-sm tracking-widest">433 GATHENHIELMS</span>
                </div>
                <h1 className="text-3xl font-bold text-white mb-1">Tjänstgöringsuppgift</h1>
                <p className="text-military-tan text-sm tracking-wide">MARINA HEMVÄRNSKOMPANI</p>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <input
                  type="text"
                  placeholder="Namn"
                  value={grundInfo.namn}
                  onChange={(e) => setGrundInfo({...grundInfo, namn: e.target.value})}
                  className="bg-gray-800 border border-gray-700 rounded p-3 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
                />
                <input
                  type="text"
                  placeholder="Personnummer"
                  value={grundInfo.personnr}
                  onChange={(e) => setGrundInfo({...grundInfo, personnr: e.target.value})}
                  className="bg-gray-800 border border-gray-700 rounded p-3 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
                />
                <input
                  type="text"
                  placeholder="Förband"
                  value={grundInfo.forband}
                  onChange={(e) => setGrundInfo({...grundInfo, forband: e.target.value})}
                  className="bg-gray-800 border border-gray-700 rounded p-3 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
                />
                <input
                  type="text"
                  placeholder="Förbandsnr"
                  value={grundInfo.forbandsnr}
                  onChange={(e) => setGrundInfo({...grundInfo, forbandsnr: e.target.value})}
                  className="bg-gray-800 border border-gray-700 rounded p-3 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
                />
                <input
                  type="text"
                  placeholder="Månad (t.ex. Oktober 2025)"
                  value={grundInfo.manad}
                  onChange={(e) => setGrundInfo({...grundInfo, manad: e.target.value})}
                  className="bg-gray-800 border border-gray-700 rounded p-3 text-white placeholder-gray-500 focus:border-military-green focus:outline-none md:col-span-2"
                />
              </div>

              <div className="border-t border-gray-700 pt-4 mb-4">
                <h2 className="text-lg font-semibold mb-3 text-white flex items-center gap-2">
                  <span className="text-military-green">▸</span> Lägg till uppgift
                </h2>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-2">
                  <input
                    type="date"
                    value={nyRad.datum}
                    onChange={(e) => setNyRad({...nyRad, datum: e.target.value})}
                    className="bg-gray-800 border border-gray-700 rounded p-2 text-white focus:border-military-green focus:outline-none col-span-2 md:col-span-1"
                  />
                  <input
                    type="text"
                    placeholder="Arbetsuppgift"
                    value={nyRad.arbetsuppgift}
                    onChange={(e) => setNyRad({...nyRad, arbetsuppgift: e.target.value})}
                    className="bg-gray-800 border border-gray-700 rounded p-2 text-white placeholder-gray-500 focus:border-military-green focus:outline-none col-span-2"
                  />
                  <input
                    type="number"
                    placeholder="Tim"
                    value={nyRad.tim}
                    onChange={(e) => setNyRad({...nyRad, tim: e.target.value})}
                    className="bg-gray-800 border border-gray-700 rounded p-2 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
                  />
                  <input
                    type="number"
                    placeholder="Km"
                    value={nyRad.km}
                    onChange={(e) => setNyRad({...nyRad, km: e.target.value})}
                    className="bg-gray-800 border border-gray-700 rounded p-2 text-white placeholder-gray-500 focus:border-military-green focus:outline-none"
                  />
                </div>
                <button
                  onClick={laggTillUppgift}
                  className="w-full bg-military-green text-white rounded p-2 flex items-center justify-center gap-2 hover:bg-opacity-90"
                >
                  <Plus /> Lägg till
                </button>
              </div>

              {uppgifter.length > 0 && (
                <div className="border-t border-gray-700 pt-4 mb-4">
                  <h2 className="text-lg font-semibold mb-3 text-white flex items-center gap-2">
                    <span className="text-military-green">▸</span> Inlagda uppgifter
                  </h2>
                  <div className="space-y-2">
                    {uppgifter.map(u => (
                      <div key={u.id} className="flex items-center gap-2 bg-gray-800 border border-gray-700 p-3 rounded hover:border-military-green transition-colors">
                        <div className="flex-1 grid grid-cols-2 md:grid-cols-4 gap-2 text-sm text-gray-300">
                          <span className="font-medium text-white">{u.datum}</span>
                          <span className="col-span-1 md:col-span-2">{u.arbetsuppgift}</span>
                          <span className="text-military-tan">{u.tim}h {u.km && `/ ${u.km}km`}</span>
                        </div>
                        <button
                          onClick={() => taBortUppgift(u.id)}
                          className="text-red-400 hover:text-red-300 transition-colors"
                        >
                          <Trash2 />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              <div className="bg-gray-800 border border-gray-700 rounded-lg p-4 mt-6">
                <h3 className="font-bold text-lg mb-2 text-white flex items-center gap-2">
                  <span className="text-2xl">📱</span> Fyller du i på mobil?
                </h3>
                <p className="text-sm text-gray-400 mb-3">Så här skriver du ut:</p>
                <ol className="text-sm text-gray-400 mb-4 space-y-1 list-decimal list-inside">
                  <li>Klicka "Kopiera länk" nedan</li>
                  <li>Skicka länken till dig själv (SMS/email)</li>
                  <li>Öppna länken på datorn</li>
                  <li>Tryck Ctrl+P (PC) eller Cmd+P (Mac)</li>
                </ol>
                
                <button
                  onClick={kopieraLank}
                  className="w-full bg-military-blue text-white rounded p-3 flex items-center justify-center gap-2 hover:brightness-110 transition-all font-semibold shadow-lg"
                >
                  <Copy /> {kopierad ? '✓ Länk kopierad!' : 'Kopiera länk'}
                </button>
              </div>

              <div className="bg-gray-800 border border-gray-700 rounded-lg p-4 mt-4">
                <h3 className="font-bold text-lg mb-2 text-white flex items-center gap-2">
                  <span className="text-2xl">🖥️</span> Vill du dela/spara som PDF?
                </h3>
                <p className="text-sm text-gray-400 mb-3">Tryck bara på knappen för att skriva ut:</p>
                
                <button
                  onClick={() => window.print()}
                  className="w-full bg-military-green text-white rounded p-3 flex items-center justify-center gap-2 hover:brightness-110 transition-all font-semibold shadow-lg"
                >
                  <Printer /> Skriv ut formulär
                </button>
              </div>
            </div>
          </div>

          {/* Utskriftsversion */}
          <div className="print-only">
            <div style={{fontFamily: 'Arial, sans-serif', padding: '15mm', fontSize: '10pt'}}>
              <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '20px'}}>
                <img src="logo-left.png" alt="Logo" style={{height: '60px'}} />
                <div style={{textAlign: 'center', flex: 1}}>
                  <div style={{fontSize: '9pt', fontWeight: 'bold'}}>
                    GÖTEBORGS GARNISON<br/>
                    ELFSBORGSGRUPPEN
                  </div>
                  <div style={{fontSize: '14pt', fontWeight: 'bold', marginTop: '15px'}}>
                    ENSKILD<br/>
                    TJÄNSTGÖRINGSUPPGIFT
                  </div>
                </div>
                <img src="logo-right.png" alt="Logo" style={{height: '60px'}} />
              </div>

              <table style={{width: '100%', borderCollapse: 'collapse', marginBottom: '15px', border: '2px solid black'}}>
                <tbody>
                  <tr>
                    <td style={{border: '1px solid black', padding: '5px', fontWeight: 'bold', width: '25%'}}>Namn</td>
                    <td style={{border: '1px solid black', padding: '5px', width: '50%'}}>{grundInfo.namn}</td>
                    <td style={{border: '1px solid black', padding: '5px', fontWeight: 'bold', width: '25%'}}>Org:</td>
                  </tr>
                  <tr>
                    <td style={{border: '1px solid black', padding: '5px', fontWeight: 'bold'}}>Personnr</td>
                    <td style={{border: '1px solid black', padding: '5px'}}>{grundInfo.personnr}</td>
                    <td style={{border: '1px solid black', padding: '5px', fontWeight: 'bold'}}>Akt:</td>
                  </tr>
                  <tr>
                    <td style={{border: '1px solid black', padding: '5px', fontWeight: 'bold'}}>Förband</td>
                    <td style={{border: '1px solid black', padding: '5px'}}>{grundInfo.forband}</td>
                    <td style={{border: '1px solid black', padding: '5px', fontWeight: 'bold'}}>Ö-tid:</td>
                  </tr>
                  <tr>
                    <td style={{border: '1px solid black', padding: '5px', fontWeight: 'bold'}}>Förbandsnr</td>
                    <td style={{border: '1px solid black', padding: '5px'}} colSpan="2">{grundInfo.forbandsnr}</td>
                  </tr>
                  <tr>
                    <td style={{border: '1px solid black', padding: '5px', fontWeight: 'bold'}}>Månad</td>
                    <td style={{border: '1px solid black', padding: '5px'}} colSpan="2">{grundInfo.manad}</td>
                  </tr>
                </tbody>
              </table>

              <table style={{width: '100%', borderCollapse: 'collapse', marginBottom: '15px', border: '2px solid black'}}>
                <thead>
                  <tr>
                    <th style={{border: '1px solid black', padding: '5px', backgroundColor: '#f0f0f0'}}>Datum</th>
                    <th style={{border: '1px solid black', padding: '5px', backgroundColor: '#f0f0f0', width: '50%'}}>Arbetsuppgift</th>
                    <th style={{border: '1px solid black', padding: '5px', backgroundColor: '#f0f0f0'}}>Antal Tim</th>
                    <th style={{border: '1px solid black', padding: '5px', backgroundColor: '#f0f0f0'}}>Km</th>
                  </tr>
                </thead>
                <tbody>
                  {uppgifter.map((u, i) => (
                    <tr key={i}>
                      <td style={{border: '1px solid black', padding: '5px'}}>{u.datum}</td>
                      <td style={{border: '1px solid black', padding: '5px'}}>{u.arbetsuppgift}</td>
                      <td style={{border: '1px solid black', padding: '5px', textAlign: 'center'}}>{u.tim}</td>
                      <td style={{border: '1px solid black', padding: '5px', textAlign: 'center'}}>{u.km}</td>
                    </tr>
                  ))}
                  {[...Array(Math.max(0, 10 - uppgifter.length))].map((_, i) => (
                    <tr key={`empty-${i}`}>
                      <td style={{border: '1px solid black', padding: '5px', height: '22px'}}>&nbsp;</td>
                      <td style={{border: '1px solid black', padding: '5px'}}>&nbsp;</td>
                      <td style={{border: '1px solid black', padding: '5px'}}>&nbsp;</td>
                      <td style={{border: '1px solid black', padding: '5px'}}>&nbsp;</td>
                    </tr>
                  ))}
                </tbody>
              </table>

              <div style={{display: 'flex', justifyContent: 'space-between', fontSize: '8pt', marginTop: '20px'}}>
                <div style={{width: '30%'}}>
                  <div style={{marginBottom: '3px', fontWeight: 'bold'}}>Ovanstående uppgifter vidimeras:</div>
                  <div>Göteborg 20___-___-___</div>
                  <div style={{marginTop: '20px', borderTop: '1px solid black', paddingTop: '3px'}}>Namnteckning</div>
                  <div style={{marginTop: '10px', borderTop: '1px solid black', paddingTop: '3px'}}>Namnförtydligande</div>
                  <div style={{marginTop: '10px', borderTop: '1px solid black', paddingTop: '3px'}}>Befattning:</div>
                </div>
                <div style={{width: '30%'}}>
                  <div style={{marginBottom: '3px', fontWeight: 'bold'}}>Ovanstående uppgifter bestyrks:</div>
                  <div>Göteborg 20___-___-___</div>
                  <div style={{marginTop: '20px', borderTop: '1px solid black', paddingTop: '3px'}}>Namnteckning</div>
                  <div style={{marginTop: '10px', borderTop: '1px solid black', paddingTop: '3px'}}>Namnförtydligande</div>
                  <div style={{marginTop: '10px', borderTop: '1px solid black', paddingTop: '3px'}}>Befattning:</div>
                </div>
                <div style={{width: '30%'}}>
                  <div style={{marginBottom: '3px', fontWeight: 'bold'}}>Indaterat:</div>
                  <div>Göteborg 20___-___-___</div>
                  <div style={{marginTop: '20px', borderTop: '1px solid black', paddingTop: '3px'}}>Namnteckning</div>
                  <div style={{marginTop: '10px', borderTop: '1px solid black', paddingTop: '3px'}}>Namnförtydligande</div>
                  <div style={{marginTop: '10px', borderTop: '1px solid black', paddingTop: '3px'}}>Befattning:</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<TjanstgoringsApp />, document.getElementById('root'));
  </script>

</body>
</html>
