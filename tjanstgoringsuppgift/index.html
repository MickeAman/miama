<!DOCTYPE html>

<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tjänstgöringsuppgift</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media print {
      .screen-only { display: none !important; }
      .print-only { display: block !important; }
      body { margin: 0; }
    }
    @media screen {
      .print-only { display: none; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide icons as inline SVG
    const Plus = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Trash2 = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
      </svg>
    );

    const Copy = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    );

    const Printer = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="6 9 6 2 18 2 18 9"></polyline>
        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
        <rect x="6" y="14" width="12" height="8"></rect>
      </svg>
    );

    function TjanstgoringsApp() {
      const [grundInfo, setGrundInfo] = useState({
        namn: '',
        personnr: '',
        forband: '',
        forbandsnr: '',
        manad: ''
      });

      const [uppgifter, setUppgifter] = useState([]);
      const [nyRad, setNyRad] = useState({ datum: '', arbetsuppgift: '', tim: '', km: '' });
      const [kopierad, setKopierad] = useState(false);

      // Ladda data från URL eller localStorage
      useEffect(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const deladeData = urlParams.get('data');
        
        if (deladeData) {
          try {
            const decoded = JSON.parse(atob(deladeData));
            setGrundInfo(decoded.grundInfo);
            setUppgifter(decoded.uppgifter);
          } catch (e) {
            console.error('Kunde inte ladda delad data');
          }
        } else {
          const sparadGrund = localStorage.getItem('grundInfo');
          const sparadeUppgifter = localStorage.getItem('uppgifter');
          if (sparadGrund) setGrundInfo(JSON.parse(sparadGrund));
          if (sparadeUppgifter) setUppgifter(JSON.parse(sparadeUppgifter));
        }
      }, []);

      useEffect(() => {
        localStorage.setItem('grundInfo', JSON.stringify(grundInfo));
      }, [grundInfo]);

      useEffect(() => {
        localStorage.setItem('uppgifter', JSON.stringify(uppgifter));
      }, [uppgifter]);

      const laggTillUppgift = () => {
        if (nyRad.datum && nyRad.arbetsuppgift) {
          setUppgifter([...uppgifter, { ...nyRad, id: Date.now() }]);
          setNyRad({ datum: '', arbetsuppgift: '', tim: '', km: '' });
        }
      };

      const taBortUppgift = (id) => {
        setUppgifter(uppgifter.filter(u => u.id !== id));
      };

      const kopieraLank = async () => {
        const data = { grundInfo, uppgifter };
        const encoded = btoa(JSON.stringify(data));
        const url = `${window.location.origin}${window.location.pathname}?data=${encoded}`;
        
        try {
          await navigator.clipboard.writeText(url);
          setKopierad(true);
          setTimeout(() => setKopierad(false), 3000);
        } catch (e) {
          alert('Länk: ' + url);
        }
      };

      return (
        <div className="min-h-screen bg-gray-50">
          {/* Mobil/Desktop redigeringsvy */}
          <div className="screen-only max-w-4xl mx-auto p-4">
            <div className="bg-white rounded-lg shadow-md p-6 mb-4">
              <h1 className="text-2xl font-bold mb-4 text-gray-800">Tjänstgöringsuppgift</h1>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <input
                  type="text"
                  placeholder="Namn"
                  value={grundInfo.namn}
                  onChange={(e) => setGrundInfo({...grundInfo, namn: e.target.value})}
                  className="border rounded p-2"
                />
                <input
                  type="text"
                  placeholder="Personnummer"
                  value={grundInfo.personnr}
                  onChange={(e) => setGrundInfo({...grundInfo, personnr: e.target.value})}
                  className="border rounded p-2"
                />
                <input
                  type="text"
                  placeholder="Förband"
                  value={grundInfo.forband}
                  onChange={(e) => setGrundInfo({...grundInfo, forband: e.target.value})}
                  className="border rounded p-2"
                />
                <input
                  type="text"
                  placeholder="Förbandsnr"
                  value={grundInfo.forbandsnr}
                  onChange={(e) => setGrundInfo({...grundInfo, forbandsnr: e.target.value})}
                  className="border rounded p-2"
                />
                <input
                  type="text"
                  placeholder="Månad (t.ex. Oktober 2025)"
                  value={grundInfo.manad}
                  onChange={(e) => setGrundInfo({...grundInfo, manad: e.target.value})}
                  className="border rounded p-2 md:col-span-2"
                />
              </div>

              <div className="border-t pt-4 mb-4">
                <h2 className="text-lg font-semibold mb-3 text-gray-700">Lägg till uppgift</h2>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-2">
                  <input
                    type="date"
                    value={nyRad.datum}
                    onChange={(e) => setNyRad({...nyRad, datum: e.target.value})}
                    className="border rounded p-2 col-span-2 md:col-span-1"
                  />
                  <input
                    type="text"
                    placeholder="Arbetsuppgift"
                    value={nyRad.arbetsuppgift}
                    onChange={(e) => setNyRad({...nyRad, arbetsuppgift: e.target.value})}
                    className="border rounded p-2 col-span-2"
                  />
                  <input
                    type="number"
                    placeholder="Tim"
                    value={nyRad.tim}
                    onChange={(e) => setNyRad({...nyRad, tim: e.target.value})}
                    className="border rounded p-2"
                  />
                  <input
                    type="number"
                    placeholder="Km"
                    value={nyRad.km}
                    onChange={(e) => setNyRad({...nyRad, km: e.target.value})}
                    className="border rounded p-2"
                  />
                </div>
                <button
                  onClick={laggTillUppgift}
                  className="w-full bg-green-600 text-white rounded p-2 flex items-center justify-center gap-2 hover:bg-green-700"
                >
                  <Plus /> Lägg till
                </button>
              </div>

              {uppgifter.length > 0 && (
                <div className="border-t pt-4 mb-4">
                  <h2 className="text-lg font-semibold mb-3 text-gray-700">Inlagda uppgifter</h2>
                  <div className="space-y-2">
                    {uppgifter.map(u => (
                      <div key={u.id} className="flex items-center gap-2 bg-gray-50 p-2 rounded">
                        <div className="flex-1 grid grid-cols-2 md:grid-cols-4 gap-2 text-sm">
                          <span className="font-medium">{u.datum}</span>
                          <span className="col-span-1 md:col-span-2">{u.arbetsuppgift}</span>
                          <span>{u.tim}h {u.km && `/ ${u.km}km`}</span>
                        </div>
                        <button
                          onClick={() => taBortUppgift(u.id)}
                          className="text-red-600 hover:text-red-800"
                        >
                          <Trash2 />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              <div className="bg-blue-50 border-2 border-blue-300 rounded-lg p-4 mt-6">
                <h3 className="font-bold text-lg mb-2 text-blue-900">📱 Fyller du i på mobil?</h3>
                <p className="text-sm text-gray-700 mb-3">Så här skriver du ut:</p>
                <ol className="text-sm text-gray-700 mb-4 space-y-1 list-decimal list-inside">
                  <li>Klicka "Kopiera länk" nedan</li>
                  <li>Skicka länken till dig själv (SMS/email)</li>
                  <li>Öppna länken på datorn</li>
                  <li>Tryck Ctrl+P (PC) eller Cmd+P (Mac)</li>
                </ol>
                
                <button
                  onClick={kopieraLank}
                  className="w-full bg-blue-600 text-white rounded p-3 flex items-center justify-center gap-2 hover:bg-blue-700 font-semibold"
                >
                  <Copy /> {kopierad ? '✓ Länk kopierad!' : 'Kopiera länk'}
                </button>
              </div>

              <div className="bg-green-50 border-2 border-green-300 rounded-lg p-4 mt-4">
                <h3 className="font-bold text-lg mb-2 text-green-900">🖥️ Skapa dokument?</h3>
                <p className="text-sm text-gray-700 mb-3">Tryck bara på knappen för att skapa/dela PDF:</p>
                
                <button
                  onClick={() => window.print()}
                  className="w-full bg-green-600 text-white rounded p-3 flex items-center justify-center gap-2 hover:bg-green-700 font-semibold"
                >
                  <Printer /> Skriv ut formulär
                </button>
              </div>
            </div>
          </div>

          {/* Utskriftsversion */}
          <div className="print-only">
            <div style={{fontFamily: 'Arial, sans-serif', padding: '20mm', fontSize: '11pt'}}>
              <div style={{textAlign: 'center', marginBottom: '30px'}}>
                <div style={{fontSize: '10pt', fontWeight: 'bold'}}>
                  GÖTEBORGS GARNISON<br/>
                  ELFSBORGSGRUPPEN
                </div>
                <div style={{fontSize: '16pt', fontWeight: 'bold', marginTop: '20px'}}>
                  ENSKILD<br/>
                  TJÄNSTGÖRINGSUPPGIFT
                </div>
              </div>

              <table style={{width: '100%', borderCollapse: 'collapse', marginBottom: '20px', border: '2px solid black'}}>
                <tbody>
                  <tr>
                    <td style={{border: '1px solid black', padding: '8px', fontWeight: 'bold', width: '25%'}}>Namn</td>
                    <td style={{border: '1px solid black', padding: '8px', width: '50%'}}>{grundInfo.namn}</td>
                    <td style={{border: '1px solid black', padding: '8px', fontWeight: 'bold', width: '25%'}}>Org:</td>
                  </tr>
                  <tr>
                    <td style={{border: '1px solid black', padding: '8px', fontWeight: 'bold'}}>Personnr</td>
                    <td style={{border: '1px solid black', padding: '8px'}}>{grundInfo.personnr}</td>
                    <td style={{border: '1px solid black', padding: '8px', fontWeight: 'bold'}}>Akt:</td>
                  </tr>
                  <tr>
                    <td style={{border: '1px solid black', padding: '8px', fontWeight: 'bold'}}>Förband</td>
                    <td style={{border: '1px solid black', padding: '8px'}}>{grundInfo.forband}</td>
                    <td style={{border: '1px solid black', padding: '8px', fontWeight: 'bold'}}>Ö-tid:</td>
                  </tr>
                  <tr>
                    <td style={{border: '1px solid black', padding: '8px', fontWeight: 'bold'}}>Förbandsnr</td>
                    <td style={{border: '1px solid black', padding: '8px'}} colSpan="2">{grundInfo.forbandsnr}</td>
                  </tr>
                  <tr>
                    <td style={{border: '1px solid black', padding: '8px', fontWeight: 'bold'}}>Månad</td>
                    <td style={{border: '1px solid black', padding: '8px'}} colSpan="2">{grundInfo.manad}</td>
                  </tr>
                </tbody>
              </table>

              <table style={{width: '100%', borderCollapse: 'collapse', marginBottom: '30px', border: '2px solid black'}}>
                <thead>
                  <tr>
                    <th style={{border: '1px solid black', padding: '8px', backgroundColor: '#f0f0f0'}}>Datum</th>
                    <th style={{border: '1px solid black', padding: '8px', backgroundColor: '#f0f0f0', width: '50%'}}>Arbetsuppgift</th>
                    <th style={{border: '1px solid black', padding: '8px', backgroundColor: '#f0f0f0'}}>Antal Tim</th>
                    <th style={{border: '1px solid black', padding: '8px', backgroundColor: '#f0f0f0'}}>Km</th>
                  </tr>
                </thead>
                <tbody>
                  {uppgifter.map((u, i) => (
                    <tr key={i}>
                      <td style={{border: '1px solid black', padding: '8px'}}>{u.datum}</td>
                      <td style={{border: '1px solid black', padding: '8px'}}>{u.arbetsuppgift}</td>
                      <td style={{border: '1px solid black', padding: '8px', textAlign: 'center'}}>{u.tim}</td>
                      <td style={{border: '1px solid black', padding: '8px', textAlign: 'center'}}>{u.km}</td>
                    </tr>
                  ))}
                  {[...Array(Math.max(0, 12 - uppgifter.length))].map((_, i) => (
                    <tr key={`empty-${i}`}>
                      <td style={{border: '1px solid black', padding: '8px', height: '30px'}}>&nbsp;</td>
                      <td style={{border: '1px solid black', padding: '8px'}}>&nbsp;</td>
                      <td style={{border: '1px solid black', padding: '8px'}}>&nbsp;</td>
                      <td style={{border: '1px solid black', padding: '8px'}}>&nbsp;</td>
                    </tr>
                  ))}
                </tbody>
              </table>

              <div style={{display: 'flex', justifyContent: 'space-between', fontSize: '9pt', marginTop: '40px'}}>
                <div style={{width: '30%'}}>
                  <div style={{marginBottom: '5px', fontWeight: 'bold'}}>Ovanstående uppgifter vidimeras:</div>
                  <div>Göteborg 20___-___-___</div>
                  <div style={{marginTop: '30px', borderTop: '1px solid black', paddingTop: '5px'}}>Namnteckning</div>
                  <div style={{marginTop: '15px', borderTop: '1px solid black', paddingTop: '5px'}}>Namnförtydligande</div>
                  <div style={{marginTop: '15px', borderTop: '1px solid black', paddingTop: '5px'}}>Befattning:</div>
                </div>
                <div style={{width: '30%'}}>
                  <div style={{marginBottom: '5px', fontWeight: 'bold'}}>Ovanstående uppgifter bestyrks:</div>
                  <div>Göteborg 20___-___-___</div>
                  <div style={{marginTop: '30px', borderTop: '1px solid black', paddingTop: '5px'}}>Namnteckning</div>
                  <div style={{marginTop: '15px', borderTop: '1px solid black', paddingTop: '5px'}}>Namnförtydligande</div>
                  <div style={{marginTop: '15px', borderTop: '1px solid black', paddingTop: '5px'}}>Befattning:</div>
                </div>
                <div style={{width: '30%'}}>
                  <div style={{marginBottom: '5px', fontWeight: 'bold'}}>Indaterat:</div>
                  <div>Göteborg 20___-___-___</div>
                  <div style={{marginTop: '30px', borderTop: '1px solid black', paddingTop: '5px'}}>Namnteckning</div>
                  <div style={{marginTop: '15px', borderTop: '1px solid black', paddingTop: '5px'}}>Namnförtydligande</div>
                  <div style={{marginTop: '15px', borderTop: '1px solid black', paddingTop: '5px'}}>Befattning:</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<TjanstgoringsApp />, document.getElementById('root'));
  </script>

</body>
</html>
